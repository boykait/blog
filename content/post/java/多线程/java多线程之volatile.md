---
title: java多线程之volatile
date: 2019-11-15
categories:
  - 多线程
  - java
tags:
  - 多线程
  - java
--- 

#### 1. 讲讲什么是volatile？
&emsp;&emsp;在JMM模型中，每个线程有私有的工作内存(寄存器、缓存等)，多个线程之间主要通过共享内存空间进行通信，那么在多个线程对同一块主存数据的操作就会引发数据的不一致性问题，若线程1对主存的副本进行修改未及时刷新到主存中，可能会使得线程2读取到的就是脏数据，那么我们的修改操作也会随之丢失，所有，volatile关键字的主要作用就是来决绝多核CPU缓存数据的不一致性问题，主要体现在三个方面：    
- 1. 保证线程对数据的操作对其他线程具备可见性；
- 2. 保证有序性，防止编译器优化重排序引入的问题；
- 3. 需要注意的是，volatile不保证数据操作的原子性。

#### 2. 如何保证可见性？
&emsp;&emsp;首先，volatile的主要作用是变量，假如线程1和线程2均将变量a拷贝到各自的私有工作空间，当线程1对a进行重新赋值等操作，赋完值后，会立马将数据刷新到主存中去，线程2随后若要使用变量a，会发现当前的变量a已经失效了，需要重新从主存中进行读取，然后在进行相关的操作，这就保证了线程1对a的写操作对线程2是可见的。如下图：

![volatile多线程写和读](/images/191115_java_threads_volatile_1.png)

##### 2. 再深入说说？
&emsp;&emsp;

